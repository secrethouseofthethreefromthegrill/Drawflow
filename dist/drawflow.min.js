!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Drawflow=e():t.Drawflow=e()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function o(t){return t.slice(5)}function n(t){return{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}}function i(t,e,o){if(void 0===o&&(o=[]),null!==e&&"object"==typeof e)for(var n in e)if(Object.hasOwnProperty.call(e,n)){var s=e[n];if("object"==typeof s&&null!==s)i(t,s,[n]);else for(var r=o.concat(n).join("-"),a=t.querySelectorAll("[df-"+r+"]"),d=0;d<a.length;d++){var c=a[d];(c instanceof HTMLInputElement||c instanceof HTMLTextAreaElement||c instanceof HTMLSelectElement)&&(c.value=s.toString()),c.isContentEditable&&(c.innerText=s.toString())}}}function s(t,e,o,n,i,s){var r={},a={on:function(t,e){return"function"!=typeof e?(console.error("The listener callback must be a function, the given type is ".concat(typeof e)),!1):"string"!=typeof t?(console.error("The event name must be a string, the given type is ".concat(typeof t)),!1):(void 0===r[t]&&(r[t]={listeners:[]}),void r[t].listeners.push(e))},removeListener:function(t,e){if(!r[t])return!1;var o=r[t].listeners,n=o.indexOf(e);n>-1&&o.splice(n,1)},dispatch:function(t,e){if(void 0===r[t])return!1;r[t].listeners.forEach((function(t){t(e)}))}},d=!1,c={nodeMoved:function(t){var e=t.id,o=t.x,i=t.y;e===n&&a.dispatch("moved",{x:o,y:i})},nodeSelected:function(t){t===n&&(a.dispatch("selected",null),d=!0)},nodeUnselected:function(){d&&a.dispatch("unselected",null)},nodeUpdated:function(t){var e=t.id,o=t.data;e===n&&a.dispatch("updated",o)},nodeUpdateId:function(t){var e=t.oldId,o=t.newId;e===n&&(n=o,a.dispatch("updatedId",o))},nodeRemoved:function(e){if(e===n){for(var o in c){var i=c[o];t.removeListener(o,i)}a.dispatch("removed",null)}},connectionStart:function(t){t.output_id===n&&a.dispatch("connectionStart",t)},connectionCreated:function(t){t.output_id!==n&&t.input_id!==n||a.dispatch("connectionCreated",t)},connectionRemoved:function(t){t.output_id!==n&&t.input_id!==n||a.dispatch("connectionRemoved",t)}};for(var l in c){var u=c[l];t.on(l,u)}e({register:t.noderegister[o],id:n,data:i,type:o,content:s,editor:t,event:a})}t.d(e,{default:()=>r});const r=function(){function t(t,e){var o,n,i,s,r,a,d,c,l,u,h,p,v,_,f,m,w;void 0===e&&(e={}),this.container=t,this.events={},this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.first_click=null,this.noderegister={},this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=2,this.zoom_min=.1,this.zoom_value=.2,this.zoom_last_value=1,this.curvature=.5,this.reroute=!1,this.reroute_fix_curvature=!1,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.evCache=[],this.prevDiff=-1,this.module=null!==(o=e.module)&&void 0!==o?o:this.module,this.editor_mode=null!==(n=e.editor_mode)&&void 0!==n?n:this.editor_mode,this.zoom=null!==(i=e.zoom)&&void 0!==i?i:this.zoom,this.zoom_max=null!==(s=e.zoom_max)&&void 0!==s?s:this.zoom_max,this.zoom_min=null!==(r=e.zoom_min)&&void 0!==r?r:this.zoom_min,this.zoom_value=null!==(a=e.zoom_value)&&void 0!==a?a:this.zoom_value,this.zoom_last_value=null!==(d=e.zoom_last_value)&&void 0!==d?d:this.zoom_last_value,this.curvature=null!==(c=e.curvature)&&void 0!==c?c:this.curvature,this.reroute=null!==(l=e.reroute)&&void 0!==l?l:this.reroute,this.reroute_fix_curvature=null!==(u=e.reroute_fix_curvature)&&void 0!==u?u:this.reroute_fix_curvature,this.reroute_curvature_start_end=null!==(h=e.reroute_curvature_start_end)&&void 0!==h?h:this.reroute_curvature_start_end,this.reroute_curvature=null!==(p=e.reroute_curvature)&&void 0!==p?p:this.reroute_curvature,this.reroute_width=null!==(v=e.reroute_width)&&void 0!==v?v:this.reroute_width,this.force_first_input=null!==(_=e.force_first_input)&&void 0!==_?_:this.force_first_input,this.draggable_inputs=null!==(f=e.draggable_inputs)&&void 0!==f?f:this.draggable_inputs,this.useuuid=null!==(m=e.useuuid)&&void 0!==m?m:this.useuuid,this.render=null!==(w=e.render)&&void 0!==w?w:this.render}return Object.defineProperty(t.prototype,"zoomLevel",{get:function(){return Math.log2(this.zoom)},set:function(t){this.zoom=Math.pow(2,t),this.refreshZoom()},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this._handleInputEnd.bind(this)),this.container.addEventListener("mousemove",this._handleInputMove.bind(this)),this.container.addEventListener("mousedown",this._handleInputStart.bind(this)),this.container.addEventListener("touchend",this._handleInputEnd.bind(this)),this.container.addEventListener("touchmove",this._handleInputMove.bind(this)),this.container.addEventListener("touchstart",this._handleInputStart.bind(this)),this.container.addEventListener("contextmenu",this._handleContextmenu.bind(this)),this.container.addEventListener("keydown",this._handleKey.bind(this)),this.container.addEventListener("wheel",this._handleZoom.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this._dblclick.bind(this)),this.container.onpointerdown=this._handlePointerdown.bind(this),this.container.onpointermove=this._handlePointermove.bind(this),this.container.onpointerup=this._handlePointerup.bind(this),this.container.onpointercancel=this._handlePointerup.bind(this),this.container.onpointerout=this._handlePointerup.bind(this),this.container.onpointerleave=this._handlePointerup.bind(this),this.load()},t.prototype._handlePointerdown=function(t){this.evCache.push(t)},t.prototype._handlePointermove=function(t){for(var e=0;e<this.evCache.length;e++)if(t.pointerId==this.evCache[e].pointerId){this.evCache[e]=t;break}if(2==this.evCache.length){var o=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(o>this.prevDiff&&this.zoomIn(),o<this.prevDiff&&this.zoomOut()),this.prevDiff=o}},t.prototype._handlePointerup=function(t){this._removeEvent(t),this.evCache.length<2&&(this.prevDiff=-1)},t.prototype._removeEvent=function(t){for(var e=this.evCache.length-1;e>=0;e--)if(this.evCache[e].pointerId==t.pointerId){this.evCache.splice(e,1);break}},t.prototype._handleInputStart=function(t){var e=this,i=function(){null!=e.node_selected&&(e.node_selected.classList.remove("selected"),e.node_selected!=e.ele_selected&&(e.node_selected=null,e.dispatch("nodeDeselected",!0))),null!=e.connection_selected&&(e.connection_selected.classList.remove("selected"),e.deselectConnection(),e.connection_selected=null)};this.dispatch("click",t);var s=t.target;if(t instanceof MouseEvent&&1===t.button)this.editor_selected=!0;else if(t instanceof MouseEvent&&0===t.button){if("fixed"===this.editor_mode){if("parent-drawflow"!==s.classList[0]&&"drawflow"!==s.classList[0])return!1;this.ele_selected=s.closest(".parent-drawflow")}else"view"===this.editor_mode?(null!=s.closest(".drawflow")||s.matches(".parent-drawflow"))&&(this.ele_selected=s.closest(".parent-drawflow"),t.preventDefault()):(this.first_click=s,this.ele_selected=s,0===t.button&&this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),null!=s.closest(".drawflow_content_node")&&(this.ele_selected=s.closest(".drawflow_content_node").parentElement));switch(this.ele_selected.classList[0]){case"drawflow-node":i(),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",o(this.ele_selected.id)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?"SELECT"!==s.tagName&&(this.drag=!0):"INPUT"!==s.tagName&&"TEXTAREA"!==s.tagName&&"SELECT"!==s.tagName&&!0!==s.hasAttribute("contenteditable")&&(this.drag=!0);break;case"output":this.connection=!0,i(),this._createConnection(s);break;case"drawflow":i(),this.editor_selected="touchstart"===t.type;break;case"main-path":i(),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected"),this.dispatch("connectionSelected",n(this.connection_selected.ownerSVGElement.classList)),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((function(t){t.classList.add("selected")}));break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeSelectedConnection(),i()}this.ele_selected.classList.contains("parent-drawflow")&&(i(),this.editor_selected="touchstart"===t.type)}t instanceof TouchEvent?(this.pos_x=t.touches[0].clientX,this.pos_x_start=t.touches[0].clientX,this.pos_y=t.touches[0].clientY,this.pos_y_start=t.touches[0].clientY):(this.pos_x=t.clientX,this.pos_x_start=t.clientX,this.pos_y=t.clientY,this.pos_y_start=t.clientY),this.dispatch("clickEnd",t)},t.prototype._handleInputMove=function(t){var e,i;if(t instanceof TouchEvent?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this.connection&&this._drawConnectionTo(e,i),this.editor_selected){var s=this.canvas_x-this.pos_x+e,r=this.canvas_y-this.pos_y+i;this.dispatch("translate",{x:s,y:r}),this.precanvas.style.transform="translate("+s+"px, "+r+"px) scale("+this.zoom+")"}if(this.drag){var a=this.drawflow.drawflow[this.module].data,d=o(this.ele_selected.id),c=(this.pos_x-e)/this.zoom,l=(this.pos_y-i)/this.zoom;this.pos_x=e,this.pos_y=i,a[d].pos_x-=c,a[d].pos_y-=l,this.ele_selected.style.left=a[d].pos_x+"px",this.ele_selected.style.top=a[d].pos_y+"px",this.updateNodeConnections(this.ele_selected.id)}if(this.drag_point){a=this.drawflow.drawflow[this.module].data,this.pos_x=e,this.pos_y=i;var u=(this.pos_x-this.precanvas.getBoundingClientRect().x)/this.zoom,h=(this.pos_y-this.precanvas.getBoundingClientRect().y)/this.zoom;this.ele_selected.setAttributeNS(null,"cx",u.toString()),this.ele_selected.setAttributeNS(null,"cy",h.toString());var p=n(this.ele_selected.parentElement.classList),v=p.output_id,_=p.input_id,f=p.output_class,m=p.input_class,w=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(w-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1)<0&&(w=0);var y=a[v].outputs[f].connections.findIndex((function(t){return t.node===_&&t.output===m}));a[v].outputs[f].connections[y].points[w]={pos_x:u,pos_y:h},this.updateNodeConnections("node-".concat(v))}"touchmove"===t.type&&(this.mouse_x=e,this.mouse_y=i),this.dispatch("mouseMove",{x:e,y:i})},t.prototype._handleInputEnd=function(t){var e,i,s;if(t instanceof TouchEvent?(e=this.mouse_x,i=this.mouse_y,s=document.elementFromPoint(e,i)):(e=t.clientX,i=t.clientY,s=t.target),this.drag&&(this.pos_x_start!=e||this.pos_y_start!=i)){var r=o(this.ele_selected.id),a=this.getNodeFromId(r);this.dispatch("nodeMoved",{id:r,x:a.pos_x,y:a.pos_y})}if(this.drag_point&&(this.ele_selected.classList.remove("selected"),this.pos_x_start==e&&this.pos_y_start==i||this.dispatch("rerouteMoved",n(this.ele_selected.parentElement.classList).output_id)),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-e),this.canvas_y=this.canvas_y+-(this.pos_y-i),this.editor_selected=!1),!0===this.connection)if("input"===s.classList[0]||this.force_first_input&&(null!=s.closest(".drawflow_content_node")||"drawflow-node"===s.classList[0])){var d=void 0,c=void 0;!this.force_first_input||null==s.closest(".drawflow_content_node")&&"drawflow-node"!==s.classList[0]?(d=s.parentElement.parentElement.id,c=s.classList[1]):(d=null!=s.closest(".drawflow_content_node")?s.closest(".drawflow_content_node").parentElement.id:s.id,c=0===Object.keys(this.getNodeFromId(o(d)).inputs).length?"":"input_1");var l=this.ele_selected.parentElement.parentElement.id,u=this.ele_selected.classList[1];if(l!==d&&c){if(0===this.container.querySelectorAll(".connection.node_in_"+d+".node_out_"+l+"."+u+"."+c).length){this.connection_ele.classList.add("node_in_"+d),this.connection_ele.classList.add("node_out_"+l),this.connection_ele.classList.add(u),this.connection_ele.classList.add(c);var h=o(d),p=o(l);this.drawflow.drawflow[this.module].data[p].outputs[u].connections.push({node:h,output:c}),this.drawflow.drawflow[this.module].data[h].inputs[c].connections.push({node:p,input:u}),this.updateNodeConnections("node-"+p),this.updateNodeConnections("node-"+h),this.dispatch("connectionCreated",{output_id:p,input_id:h,output_class:u,input_class:c})}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null;this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1,this.dispatch("mouseUp",t)},t.prototype._handleContextmenu=function(t){if(this.dispatch("contextmenu",t),t.preventDefault(),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var e=document.createElement("div");e.classList.add("drawflow-delete"),e.innerHTML="x",this.node_selected&&this.node_selected.appendChild(e),this.connection_selected&&(e.style.top=t.clientY*this.zoom-this.precanvas.getBoundingClientRect().y*this.zoom+"px",e.style.left=t.clientX*this.zoom-this.precanvas.getBoundingClientRect().x*this.zoom+"px",this.precanvas.appendChild(e))}},t.prototype._handleKey=function(t){if(this.dispatch("keydown",t),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;("Delete"===t.key||"Backspace"===t.key&&t.metaKey)&&(null!=this.node_selected&&"INPUT"!==this.first_click.tagName&&"TEXTAREA"!==this.first_click.tagName&&!0!==this.first_click.hasAttribute("contenteditable")&&this.removeNodeId(this.node_selected.id),null!=this.connection_selected&&this.removeSelectedConnection())},t.prototype._handleZoom=function(t){t.preventDefault(),t.ctrlKey?this.zoomLevel-=t.deltaY/100:(this.canvas_x-=t.deltaX,this.canvas_y-=t.deltaY,this.dispatch("translate",{x:this.canvas_x,y:this.canvas_y}),this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")")},t.prototype._dblclick=function(t){null!=this.connection_selected&&this.reroute&&this.createReroutePoint(this.connection_selected),"point"===t.target.classList[0]&&this.removeReroutePoint(t.target)},t.prototype.refreshZoom=function(t){void 0===t&&(t=!1),this.zoom=Math.min(Math.max(this.zoom_min,this.zoom),this.zoom_max),t||this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"},t.prototype.zoomIn=function(t){void 0===t&&(t=this.zoom_value),this.zoomLevel+=t},t.prototype.zoomOut=function(t){void 0===t&&(t=this.zoom_value),this.zoomLevel-=t},t.prototype.resetZoom=function(t){void 0===t&&(t=!1),1!=this.zoom&&(this.zoom=1,this.refreshZoom(t))},t.prototype.load=function(){for(var t in this.drawflow.drawflow[this.module].data)this._addNodeImport(this.drawflow.drawflow[this.module].data[t],this.precanvas);if(this.reroute)for(var t in this.drawflow.drawflow[this.module].data)this._addRerouteImport(this.drawflow.drawflow[this.module].data[t]);for(var t in this.drawflow.drawflow[this.module].data)this.updateNodeConnections("node-"+t);var e=this.drawflow.drawflow,o=1;for(var n in e)if(Object.hasOwnProperty.call(e,n)){var i=e[n].data;for(var s in i)Object.hasOwnProperty.call(i,s)&&(o=Math.max(o,parseInt(s)+1))}this.nodeId=o},t.prototype.deselectConnection=function(t){void 0===t&&(t=!1),t||this.dispatch("connectionDeselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((function(t){t.classList.remove("selected")}))},t.prototype.createCurvature=function(t,e,o,n,i){var s=t,r=e,a=o,d=n,c=Math.abs(a-s)*i;return"M"+[s,r].join()+"C"+[s+c,r,a-c,d,a,d].join()},t.prototype._createConnection=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=e;var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.classList.add("main-path"),n.setAttributeNS(null,"d",""),e.classList.add("connection"),e.appendChild(n),this.precanvas.appendChild(e);var i=o(t.parentElement.parentElement.id),s=t.classList[1];this.dispatch("connectionStart",{output_id:i,output_class:s})},t.prototype._drawConnectionTo=function(t,e){var o,n=this.precanvas,i=this.zoom,s=n.getBoundingClientRect(),r=this.connection_ele.children[0],a=[((o=this.ele_selected.getBoundingClientRect()).x-s.x+o.width/2)/i,(o.y-s.y+o.width/2)/i],d=a[0],c=a[1],l=(t-this.precanvas.getBoundingClientRect().x)/i,u=(e-this.precanvas.getBoundingClientRect().y)/i,h=this.curvature,p=this.createCurvature(d,c,l,u,h);r.setAttributeNS(null,"d",p)},t.prototype.addConnection=function(t,e,o,n,i){void 0===i&&(i=!1);var s=this.getModuleFromNodeId(t);if(s===this.getModuleFromNodeId(e)){var r=this.drawflow.drawflow[s].data;if(r&&r[t]&&r[t].outputs[o]&&r[e]&&r[e].inputs[n]){for(var a=0,d=r[t].outputs[o].connections;a<d.length;a++){var c=d[a];if(c.node==e&&c.output==n)return}if(r[t].outputs[o].connections.push({node:e.toString(),output:n}),r[e].inputs[n].connections.push({node:t.toString(),input:o}),this.module===s){var l=document.createElementNS("http://www.w3.org/2000/svg","svg"),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.classList.add("main-path"),u.setAttributeNS(null,"d",""),l.classList.add("connection"),l.classList.add("node_in_node-"+e),l.classList.add("node_out_node-"+t),l.classList.add(o),l.classList.add(n),l.appendChild(u),this.precanvas.appendChild(l),this.updateNodeConnections("node-"+t),this.updateNodeConnections("node-"+e)}i||this.dispatch("connectionCreated",{output_id:t,input_id:e,output_class:o,input_class:n})}}},t.prototype.updateConnection=function(t,e,o){var n=this.container,i=this.precanvas,s=this.curvature,r=this.createCurvature,a=this.reroute_curvature,d=this.reroute_curvature_start_end,c=this.reroute_fix_curvature,l=this.reroute_width,u=this.zoom;if(!e){var h=t.classList[2].replace("node_out_","");e=n.querySelector("#".concat(h))}if(!o){var p=t.classList[1].replace("node_in_","");o=n.querySelector("#".concat(p))}if(e&&o){var v,_=i.getBoundingClientRect(),f=k(e.querySelector("."+t.classList[3])),m=f[0],w=f[1],y=k(o.querySelector("."+t.classList[4])),g=y[0],x=y[1],C=t.querySelectorAll(".point");if(0===C.length){var L=r(m,w,g,x,s);t.children[0].setAttributeNS(null,"d",L)}else{for(var N="",E=[],b=m,S=w,I=d,z=0;z<C.length;z++){var O=(void 0,[((v=C[z].getBoundingClientRect()).x-_.x)/u+l,(v.y-_.y)/u+l]),A=O[0],M=O[1],j=r(b,S,A,M,I);N+=j,E.push(j),b=A,S=M,I=a}var q=r(b,S,g,x,I=d);N+=q,E.push(q),c?E.forEach((function(e,o){t.children[o].setAttributeNS(null,"d",e)})):t.children[0].setAttributeNS(null,"d",N)}}function k(t){var e=t.getBoundingClientRect();return[(e.x-_.x+e.width/2)/u,(e.y-_.y+e.width/2)/u]}},t.prototype.updateNodeConnections=function(t){for(var e="node_in_"+t,o="node_out_"+t,n=this.container,i=n.querySelector("#node-".concat(t)),s=n.querySelectorAll(".".concat(o)),r=0;r<s.length;r++){var a=s[r];this.updateConnection(a,i,null)}var d=n.querySelectorAll(".".concat(e));for(r=0;r<d.length;r++)a=d[r],this.updateConnection(a,null,i)},t.prototype.createReroutePoint=function(t,e){void 0===e&&(e=!1),this.connection_selected.classList.remove("selected");var o=n(this.connection_selected.parentElement.classList),i=o.output_id,s=o.input_id,r=o.output_class,a=o.input_class;this.connection_selected=null;var d=document.createElementNS("http://www.w3.org/2000/svg","circle");d.classList.add("point");var c=(this.pos_x-this.precanvas.getBoundingClientRect().x)*this.zoom,l=(this.pos_y-this.precanvas.getBoundingClientRect().y)*this.zoom;d.setAttributeNS(null,"cx",c.toString()),d.setAttributeNS(null,"cy",l.toString()),d.setAttributeNS(null,"r",this.reroute_width.toString());var u=0;if(this.reroute_fix_curvature){var h=t.parentElement.querySelectorAll(".main-path").length,p=document.createElementNS("http://www.w3.org/2000/svg","path");if(p.classList.add("main-path"),p.setAttributeNS(null,"d",""),t.parentElement.insertBefore(p,t.parentElement.children[h]),1===h)t.parentElement.appendChild(d);else{var v=Array.from(t.parentElement.children).indexOf(t);u=v,t.parentElement.insertBefore(d,t.parentElement.children[v+h+1])}}else t.parentElement.appendChild(d);var _=this.drawflow.drawflow[this.module].data[i].outputs[r].connections.find((function(t){return t.node===s&&t.output===a}));void 0===_.points&&(_.points=[]),this.reroute_fix_curvature?(u>0?_.points.splice(u,0,{pos_x:c,pos_y:l}):_.points.push({pos_x:c,pos_y:l}),t.parentElement.querySelectorAll(".main-path.selected").forEach((function(t){return t.classList.remove("selected")}))):_.points.push({pos_x:c,pos_y:l}),e||this.dispatch("rerouteCreated",i),this.updateConnection(t.ownerSVGElement)},t.prototype.removeReroutePoint=function(t,e){void 0===e&&(e=!1);var o=n(t.ownerSVGElement.classList),i=o.output_id,s=o.input_id,r=o.output_class,a=o.input_class,d=Array.from(t.parentElement.children).indexOf(t)-1,c=this.drawflow.drawflow[this.module].data[i].outputs[r].connections.findIndex((function(t){return t.node===s&&t.output===a}));if(this.reroute_fix_curvature){var l=t.parentElement.querySelectorAll(".main-path").length;t.parentElement.children[l-1].remove(),(d-=l)<0&&(d=0)}this.drawflow.drawflow[this.module].data[i].outputs[r].connections[c].points.splice(d,1),t.remove(),e||this.dispatch("rerouteRemoved",i),this.updateNodeConnections("node-".concat(i))},t.prototype.registerNode=function(t,e){this.noderegister[t]=e},t.prototype.getNodeFromId=function(t){var e=this.getModuleFromNodeId(t);if(e)return JSON.parse(JSON.stringify(this.drawflow.drawflow[e].data[t]))},t.prototype.getNodesFromName=function(t){var e=[],o=this.drawflow.drawflow;return Object.keys(o).map((function(n){for(var i in o[n].data)o[n].data[i].name==t&&e.push(o[n].data[i].id)})),e},t.prototype.addNode=function(t,e,o,n,r,a,d,c,l,u){var h,p,v;void 0===l&&(l=!1),void 0===u&&(u=!1),v=this.useuuid?this.getUuid():this.nodeId.toString();var _=document.createElement("div");_.classList.add("parent-node");var f=document.createElement("div");f.setAttribute("id","node-"+v),f.classList.add("drawflow-node"),a&&(h=f.classList).add.apply(h,a.split(" "));var m=document.createElement("div");m.classList.add("inputs");var w=document.createElement("div");w.classList.add("outputs");for(var y={},g=0;g<e;g++){var x=document.createElement("div");x.classList.add("input"),x.classList.add("input_"+(g+1)),y["input_"+(g+1)]={connections:[]},m.appendChild(x)}var C={};for(g=0;g<o;g++){var L=document.createElement("div");L.classList.add("output"),L.classList.add("output_"+(g+1)),C["output_"+(g+1)]={connections:[]},w.appendChild(L)}var N=document.createElement("div");N.classList.add("drawflow_content_node"),i(N,d),f.style.top=r+"px",f.style.left=n+"px",f.appendChild(m),f.appendChild(N),f.appendChild(w),_.appendChild(f),this.precanvas.appendChild(_);var E={id:v,name:t,data:function t(e,o){if(void 0===o&&(o=!0),null==e||"object"!=typeof e&&o)return{};if("object"==typeof e&&!Array.isArray(e)){var n={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];n[i]=t(s,!1)}return n}return e.toString()}(d),class:a,html:c,typenode:l,inputs:y,outputs:C,pos_x:n,pos_y:r};return!1===l?N.innerHTML=c:!0===l?N.appendChild(null===(p=this.noderegister[c])||void 0===p?void 0:p.cloneNode(!0)):s(this,"function"==typeof l?l:this.render,c,v,E,N),this.drawflow.drawflow[this.module].data[v]=E,u||this.dispatch("nodeCreated",v),this.useuuid||this.nodeId++,v},t.prototype._addNodeImport=function(t,e){var o;t.id=t.id.toString();var n=document.createElement("div");n.classList.add("parent-node");var r=document.createElement("div");r.setAttribute("id","node-"+t.id),r.classList.add("drawflow-node"),t.class&&(o=r.classList).add.apply(o,t.class.split(" "));var a=document.createElement("div");a.classList.add("inputs");var d=document.createElement("div");for(var c in d.classList.add("outputs"),t.inputs)if(Object.hasOwnProperty.call(t.inputs,c)){var l=t.inputs[c].connections,u=document.createElement("div");for(var h in u.classList.add("input"),u.classList.add(c),a.appendChild(u),l)if(Object.hasOwnProperty.call(l,h)){var p=l[h];p.node=p.node.toString();var v=document.createElementNS("http://www.w3.org/2000/svg","svg"),_=document.createElementNS("http://www.w3.org/2000/svg","path");_.classList.add("main-path"),_.setAttributeNS(null,"d",""),v.classList.add("connection"),v.classList.add("node_in_node-"+t.id),v.classList.add("node_out_node-"+p.node),v.classList.add(p.input),v.classList.add(c),v.appendChild(_),e.appendChild(v)}}for(var f=0;f<Object.keys(t.outputs).length;f++){var m=document.createElement("div");m.classList.add("output"),m.classList.add("output_"+(f+1)),d.appendChild(m)}var w=document.createElement("div");w.classList.add("drawflow_content_node"),!1===t.typenode?w.innerHTML=t.html:!0===t.typenode?w.appendChild(this.noderegister[t.html].cloneNode(!0)):"function"==typeof t.typenode?s(this,t.typenode,t.html,t.id,t,w):s(this,this.render,t.html,t.id,t,w),i(w,t.data),r.style.top=t.pos_y+"px",r.style.left=t.pos_x+"px",r.appendChild(a),r.appendChild(w),r.appendChild(d),n.appendChild(r),this.precanvas.appendChild(n)},t.prototype._addRerouteImport=function(t){var e=this.reroute_width,o=this.reroute_fix_curvature,n=this.container;for(var i in t.outputs)if(Object.prototype.hasOwnProperty.call(t.outputs,i)){var s=t.outputs[i];for(var r in s.connections)if(Object.prototype.hasOwnProperty.call(s.connections,r)){var a=s.connections[r],d=a.points;if(Array.isArray(a.points)){var c=a.node,l=a.output,u=n.querySelector(".connection.node_in_node-"+c+".node_out_node-"+t.id+"."+s+"."+l);if(o)for(var h=0;h<d.length;h++){var p=document.createElementNS("http://www.w3.org/2000/svg","path");p.classList.add("main-path"),p.setAttributeNS(null,"d",""),u.appendChild(p)}for(var v=0,_=a.points;v<_.length;v++){var f=_[v],m=document.createElementNS("http://www.w3.org/2000/svg","circle");m.classList.add("point"),m.setAttributeNS(null,"cx",f.pos_x.toString()),m.setAttributeNS(null,"cy",f.pos_y.toString()),m.setAttributeNS(null,"r",e.toString()),u.appendChild(m)}}}}},t.prototype.changeNodeID=function(t,e,o){void 0===o&&(o=!1);var n=this.getModuleFromNodeId(t);if(!n)return!1;var i=this.drawflow.drawflow[n].data,s=i[t];if(this.getNodeFromId(e)||t===e)return!1;delete i[t],i[e]=s,s.id=e;var r=this.precanvas.querySelector("#node-".concat(t));for(var a in r.id="node-".concat(e),s.inputs)for(var d=0,c=s.inputs[a].connections;d<c.length;d++){var l=c[d],u=this.getNodeFromId(l.node);for(var h in u.outputs)for(var p=0,v=u.outputs[h].connections;p<v.length;p++)(x=v[p]).node===t&&x.output===a&&(x.node=e)}for(var h in s.outputs)for(var _=0,f=s.outputs[h].connections;_<f.length;_++){var m=f[_],w=this.getNodeFromId(m.node);for(var a in w.inputs)for(var y=0,g=w.inputs[a].connections;y<g.length;y++){var x;(x=g[y]).node===t&&x.input===h&&(x.node=e)}}return this.precanvas.querySelectorAll(".node_in_node-".concat(t,",.node_out_node-").concat(e)).forEach((function(o){o.classList.replace(".node_in_node-".concat(t),".node_in_node-".concat(e)),o.classList.replace(".node_out_node-".concat(t),".node_out_node-".concat(e))})),o||this.dispatch("updateNodeId",{oldId:t,newId:s.id}),!0},t.prototype.updateNodeValue=function(t,e){void 0===e&&(e=!1);for(var n=t.target,i=n.attributes,s=0;s<i.length;s++)if(i[s].nodeName.startsWith("df-")){for(var r=i[s].nodeName.slice(3).split("-"),a=this.drawflow.drawflow[this.module].data[o(n.closest(".drawflow_content_node").parentElement.id)].data,d=0;d<r.length-1;d+=1)null==a[r[d]]&&(a[r[d]]={}),a=a[r[d]];a[r[r.length-1]]=n.value,n.isContentEditable&&(a[r[r.length-1]]=n.innerText),e||this.dispatch("nodeDataChanged",o(n.closest(".drawflow_content_node").parentElement.id))}},t.prototype.updateNodeDataFromId=function(t,e){var o=this.getModuleFromNodeId(t);this.drawflow.drawflow[o].data[t].data=e,this.module===o&&i(this.container.querySelector("#node-"+t),e)},t.prototype.addNodeInput=function(t){var e=this.getModuleFromNodeId(t),o=this.getNodeFromId(t),n=Object.keys(o.inputs).length;if(this.module===e){var i=document.createElement("div");i.classList.add("input"),i.classList.add("input_"+(n+1)),this.container.querySelector("#node-"+t+" .inputs").appendChild(i),this.updateNodeConnections("node-"+t)}this.drawflow.drawflow[e].data[t].inputs["input_"+(n+1)]={connections:[]}},t.prototype.addNodeOutput=function(t){var e=this.getModuleFromNodeId(t),o=this.getNodeFromId(t),n=Object.keys(o.outputs).length;if(this.module===e){var i=document.createElement("div");i.classList.add("output"),i.classList.add("output_"+(n+1)),this.container.querySelector("#node-"+t+" .outputs").appendChild(i),this.updateNodeConnections("node-"+t)}this.drawflow.drawflow[e].data[t].outputs["output_"+(n+1)]={connections:[]}},t.prototype.removeNodeInput=function(t,e,o){void 0===o&&(o=!1);var n=this.getModuleFromNodeId(t),i=this.drawflow.drawflow[n].data[t];this.module===n&&this.container.querySelector("#node-"+t+" .inputs .input."+e).remove();for(var s=0,r=i.inputs[e].connections;s<r.length;s++){var a=r[s];this.removeConnection(a.node,t,a.input,e,o)}for(var d=parseInt(e.slice("input_".length))-1,c=Object.keys(i.inputs).length,l=d;l<=c;l++){var u="input_"+(l+1),h="input_"+(l+2);i.inputs[u]=i.inputs[h];for(var p=0,v=i.inputs[u].connections;p<v.length;p++){var _=v[p],f=this.drawflow.drawflow[n].data[_.node];for(var m in f.outputs)if(Object.prototype.hasOwnProperty.call(f.outputs,m))for(var w=0,y=f.outputs[m].connections;w<y.length;w++){var g=y[w];g.node===t&&g.output===h&&(g.output=u,this.module===n&&this.container.querySelector(".connection.node_in_node-"+g.node+".node_out_node-"+_.node+"."+g.output+"."+_.input).classList.replace(h,u))}}this.module===n&&this.container.querySelector("#node-"+t+" .inputs .input"+h).classList.replace(h,u)}delete i.inputs["input_"+c],this.updateNodeConnections("node-"+t)},t.prototype.removeNodeOutput=function(t,e,o){void 0===o&&(o=!1);var n=this.getModuleFromNodeId(t),i=this.drawflow.drawflow[n].data[t];this.module===n&&this.container.querySelector("#node-"+t+" .outputs .output."+e).remove();for(var s=0,r=i.outputs[e].connections;s<r.length;s++){var a=r[s];this.removeConnection(a.node,t,a.output,e,o)}for(var d=parseInt(e.slice("output_".length))-1,c=Object.keys(i.outputs).length,l=d;l<=c;l++){var u="output_"+(l+1),h="output_"+(l+2);i.outputs[u]=i.outputs[h];for(var p=0,v=i.outputs[u].connections;p<v.length;p++){var _=v[p],f=this.drawflow.drawflow[n].data[_.node];for(var m in f.inputs)if(Object.prototype.hasOwnProperty.call(f.inputs,m))for(var w=0,y=f.inputs[m].connections;w<y.length;w++){var g=y[w];g.node===t&&g.input===h&&(g.input=u,this.module===n&&this.container.querySelector(".connection.node_in_node-"+g.node+".node_out_node-"+_.node+"."+g.input+"."+_.output).classList.replace(h,u))}}this.module===n&&this.container.querySelector("#node-"+t+" .outputs .output"+h).classList.replace(h,u)}delete i.outputs["output_"+c],this.updateNodeConnections("node-"+t)},t.prototype.removeNodeId=function(t,e){void 0===e&&(e=!0),this.removeNodeConnectionsByNodeId(t,e);var n=this.getModuleFromNodeId(o(t));this.module===n&&this.container.querySelector("#".concat(t)).remove(),delete this.drawflow.drawflow[n].data[o(t)],e||this.dispatch("nodeRemoved",o(t))},t.prototype.removeSelectedConnection=function(t){if(void 0===t&&(t=!1),null!=this.connection_selected){var e=this.connection_selected.parentElement,o=n(e.classList),i=o.output_id,s=o.input_id,r=o.output_class,a=o.input_class;e.remove();var d=this.drawflow.drawflow[this.module].data,c=d[i].outputs[r].connections.findIndex((function(t){return t.node===s&&t.output===a}));d[i].outputs[r].connections.splice(c,1);var l=d[s].inputs[a].connections.findIndex((function(t){return t.node===i&&t.input===r}));d[s].inputs[a].connections.splice(l,1),t||this.dispatch("connectionRemoved",{output_id:i,input_id:s,output_class:r,input_class:a}),this.connection_selected=null}},t.prototype.removeConnection=function(t,e,o,n,i){void 0===i&&(i=!1);var s=this.getModuleFromNodeId(t);if(s===this.getModuleFromNodeId(e)){if(this.drawflow.drawflow[s].data[t].outputs[o].connections.findIndex((function(t){return t.node==e&&t.output===n}))>-1){this.module===s&&this.container.querySelector(".connection.node_in_node-"+e+".node_out_node-"+t+"."+o+"."+n).remove();var r=this.drawflow.drawflow[s].data[t].outputs[o].connections.findIndex((function(t){return t.node==e&&t.output===n}));this.drawflow.drawflow[s].data[t].outputs[o].connections.splice(r,1);var a=this.drawflow.drawflow[s].data[e].inputs[n].connections.findIndex((function(e){return e.node==t&&e.input===o}));return this.drawflow.drawflow[s].data[e].inputs[n].connections.splice(a,1),i||this.dispatch("connectionRemoved",{output_id:t,input_id:e,output_class:o,input_class:n}),!0}return!1}return!1},t.prototype.removeNodeConnectionsByNodeId=function(t,e){void 0===e&&(e=!1);for(var o="node_in_"+t,i="node_out_"+t,s=this.drawflow.drawflow[this.module].data,r=this.container.querySelectorAll(".".concat(i)),a=function(t){var o=n(r[t].classList),i=o.output_id,a=o.input_id,c=o.output_class,l=o.input_class,u=s[a].inputs[l].connections.findIndex((function(t){return t.node===i&&t.input===c}));s[a].inputs[l].connections.splice(u,1);var h=s[i].outputs[c].connections.findIndex((function(t){return t.node===a&&t.output===l}));s[i].outputs[c].connections.splice(h,1),r[t].remove(),e||d.dispatch("connectionRemoved",{output_id:i,input_id:a,output_class:c,input_class:l})},d=this,c=r.length-1;c>=0;c--)a(c);var l=this.container.querySelectorAll(".".concat(o)),u=function(t){var o=n(l[t].classList),i=o.output_id,r=o.input_id,a=o.output_class,d=o.input_class,c=s[i].outputs[a].connections.findIndex((function(t){return t.node===r&&t.output===d}));s[i].outputs[a].connections.splice(c,1);var u=s[r].inputs[d].connections.findIndex((function(t){return t.node===i&&t.input===a}));s[r].inputs[d].connections.splice(u,1),l[t].remove(),e||h.dispatch("connectionRemoved",{output_id:i,input_id:r,output_class:a,input_class:d})},h=this;for(c=l.length-1;c>=0;c--)u(c)},t.prototype.getModuleFromNodeId=function(t){var e=this.drawflow.drawflow;for(var o in e)if(Object.hasOwnProperty.call(e,o)){var n=e[o].data;for(var i in n)if(Object.hasOwnProperty.call(n,i)&&i===t.toString())return o}},t.prototype.addModule=function(t,e){void 0===e&&(e=!1),this.drawflow.drawflow[t]={data:{}},e||this.dispatch("moduleCreated",t)},t.prototype.changeModule=function(t,e){void 0===e&&(e=!1),e||this.dispatch("moduleChanged",t),this.module=t,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow,!1)},t.prototype.removeModule=function(t,e){void 0===e&&(e=!1),this.module===t&&this.changeModule("Home",e),delete this.drawflow.drawflow[t],e||this.dispatch("moduleRemoved",t)},t.prototype.clearSelectedModule=function(){for(;this.precanvas.hasChildNodes();)this.precanvas.firstChild.remove();this.drawflow.drawflow[this.module]={data:{}}},t.prototype.clear=function(){for(;this.precanvas.hasChildNodes();)this.precanvas.firstChild.remove();this.drawflow={drawflow:{Home:{data:{}}}}},t.prototype.export=function(t){void 0===t&&(t=!1);var e=JSON.parse(JSON.stringify(this.drawflow));return t||this.dispatch("export",e),e},t.prototype.import=function(t,e){void 0===e&&(e=!1),this.clear(),this.drawflow=JSON.parse(JSON.stringify(t)),this.load(),e||this.dispatch("import","import")},t.prototype.on=function(t,e){return"function"!=typeof e?(console.error("The listener callback must be a function, the given type is ".concat(typeof e)),!1):"string"!=typeof t?(console.error("The event name must be a string, the given type is ".concat(typeof t)),!1):(void 0===this.events[t]&&(this.events[t]={listeners:[]}),this.events[t].listeners.push(e),!0)},t.prototype.removeListener=function(t,e){if(!this.events[t])return!1;var o=this.events[t].listeners,n=o.indexOf(e),i=n>-1;return i&&o.splice(n,1),i},t.prototype.dispatch=function(t,e){if(void 0===this.events[t])return!1;for(var o=0,n=this.events[t].listeners.slice();o<n.length;o++)(0,n[o])(e);return!0},t.prototype.getUuid=function(){for(var t=[],e="0123456789abcdef",o=0;o<36;o++)t[o]=e.charAt(Math.floor(16*Math.random()));return t[14]="4",t[19]=e.charAt(3&parseInt(t[19],16)|8),t[8]=t[13]=t[18]=t[23]="-",t.join("")},t}();return e.default})()));
//# sourceMappingURL=drawflow.min.js.map